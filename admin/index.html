<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Zentryx CMS</title>
  </head>
  <body>
    <!-- Rădăcina UI-ului Decap -->
    <div id="nc-root"></div>

    <!-- Încarcă Decap după ce există #nc-root -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <!-- Bridge: dacă revenim cu token în hash, îl trimitem către aplicația Decap -->
    <script>
      (function () {
        function tryConsumeFromHash() {
          var m = (location.hash || '').match(/auth:github:success:([^&]+)/);
          if (!m) return;
          var token = decodeURIComponent(m[1]);
          // Trimite mesajul în ambele formate pe care le suportă Decap
          window.postMessage('authorization:github:success:' + token, window.location.origin);
          window.postMessage({ token: token }, window.location.origin);
          // Curăță hash-ul și revino pe dashboard
          history.replaceState({}, '', location.pathname + '#/');
        }

        // La load și puțin după (în caz că listenerul Decap pornește cu delay)
        window.addEventListener('load', tryConsumeFromHash);
        setTimeout(tryConsumeFromHash, 150);
      })();
    </script>
  </body>
</html>
